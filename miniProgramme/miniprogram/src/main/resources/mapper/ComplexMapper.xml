<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.miniprogram.mapper.ComplexMapper">
    <resultMap id="DynamicResultMap" type="com.example.miniprogram.entity.DynamicPlus">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sun May 24 14:59:29 CST 2020.
        -->
        <id column="dynamic_id" jdbcType="BIGINT" property="dynamicId" />
        <result column="dynamic_address" jdbcType="VARCHAR" property="dynamicAddress" />
        <result column="dynamic_require" jdbcType="VARCHAR" property="dynamicRequire" />
        <result column="dynamic_date" jdbcType="VARCHAR" property="dynamicDate" />
        <result column="dynamic_area" jdbcType="VARCHAR" property="dynamicArea" />
        <result column="dynamic_who" jdbcType="VARCHAR" property="dynamicWho" />
        <result column="dynamic_num" jdbcType="BIGINT" property="dynamicNum" />
        <result column="dynamic_time" jdbcType="VARCHAR" property="dynamicTime" />
        <result column="dynamic_money" jdbcType="VARCHAR" property="dynamicMoney" />
        <result column="dynamic_finish" jdbcType="VARCHAR" property="dynamicFinish" />
        <result column="dynamic_img" jdbcType="VARCHAR" property="dynamicImg" />
        <result column="dynamic_style" jdbcType="VARCHAR" property="dynamicStyle" />
        <result column="dynamic_userid" jdbcType="BIGINT" property="dynamicUserid" />
        <result column="dynamic_gender" jdbcType="VARCHAR" property="dynamicGender" />
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="user_avater" jdbcType="VARCHAR" property="userAvater"/>
        <result column="user_identity" jdbcType="VARCHAR" property="userIdentity"/>
    </resultMap>
    <resultMap id="appointmentResultMap" type="com.example.miniprogram.entity.AppointmentPlus">
        <id column="appointment_id" jdbcType="BIGINT" property="appointmentId" />
        <result column="appointment_userid1" jdbcType="BIGINT" property="appointmentUserid1" />
        <result column="appointment_userid2" jdbcType="BIGINT" property="appointmentUserid2" />
        <result column="appointment_time" jdbcType="VARCHAR" property="appointmentTime" />
        <result column="appointment_agree" jdbcType="INTEGER" property="appointmentAgree" />
        <result column="appointment_reason" jdbcType="VARCHAR" property="appointmentReason" />
        <result column="appointment_fromId" jdbcType="BIGINT" property="appointmentFromid" />
        <result column="user_name" jdbcType="VARCHAR" property="userName" />
        <result column="user_avater" jdbcType="VARCHAR" property="userAvater" />
        <result column="user_identity" jdbcType="VARCHAR" property="userIdentity" />
        <result column="user_address" jdbcType="VARCHAR" property="userAddress" />
        <result column="user_gender" jdbcType="VARCHAR" property="userGender" />
    </resultMap>
    <select id="selectWx"  resultType="String">
    SELECT user_wx
    FROM `user`
    WHERE user_id=#{id}
   </select>
    <select id="selectPhone"  resultType="String">
    SELECT user_phone
    FROM `user`
    WHERE user_id=#{id}
   </select>
    <select id="getFollowList">
    select user_avater,user_name,user_gender
    from user
    join
    (
    SELECT followed_id
    FROM follow
    where follow_id=#{follow_id};
    SELECT
     user_avater,
     user_name,
     user_gender
    FORM user,follow
    WHERE user.user_id=follow.follow_id
    )Follow
    on user.user_id=Follow.followed_id
    </select>
    <select id="selectAllDynamics" resultMap="DynamicResultMap">
        SELECT
        dynamic.dynamic_id,
        dynamic.dynamic_address,
        dynamic.dynamic_require,
        dynamic.dynamic_date,
        dynamic.dynamic_area,
        dynamic.dynamic_who,
        dynamic.dynamic_num,
        dynamic.dynamic_time,
        dynamic.dynamic_money,
        dynamic.dynamic_finish,
        dynamic.dynamic_img,
        dynamic.dynamic_style,
        dynamic.dynamic_userid,
        dynamic.dynamic_gender,
        `user`.user_identity,
        `user`.user_name,
        `user`.user_avater
        FROM
        dynamic ,
        `user`
        WHERE
        dynamic.dynamic_userid = `user`.user_id
    </select>
    <select id="selectDynamicsByTags" resultMap="DynamicResultMap">
        SELECT
        dynamic.dynamic_id,
        dynamic.dynamic_address,
        dynamic.dynamic_require,
        dynamic.dynamic_date,
        dynamic.dynamic_area,
        dynamic.dynamic_who,
        dynamic.dynamic_num,
        dynamic.dynamic_time,
        dynamic.dynamic_money,
        dynamic.dynamic_finish,
        dynamic.dynamic_img,
        dynamic.dynamic_style,
        dynamic.dynamic_userid,
        dynamic.dynamic_gender,
        `user`.user_identity,
        `user`.user_name,
        `user`.user_avater
        FROM
        dynamic ,
        `user`
        WHERE
        <if test="region !='全国' ">
            dynamic.dynamic_area LIKE CONCAT(CONCAT('%', #{region}),'%')
        </if>
        <if test="identity !='身份' ">
            dynamic.dynamic_who = #{identity}
        </if>
        <if test="gender !='性别' ">
            dynamic.dynamic_gender = #{gender}
        </if>
        <if test="style !='风格' ">
            dynamic.dynamic_style LIKE CONCAT(CONCAT('%', #{style}),'%')
        </if>
        dynamic.dynamic_userid = `user`.user_id
    </select>
    <select id="selectReceiveApt" resultMap="appointmentResultMap">
        SELECT
          appointment.appointment_id,
          appointment.appointment_userid1,
          appointment.appointment_userid2,
          appointment.appointment_time,
          appointment.appointment_agree,
          appointment.appointment_reason,
          appointment.appointment_fromId,
          `user`.user_name,
          `user`.user_gender,
          `user`.user_avater,
          `user`.user_address,
          `user`.user_identity
          FROM
          appointment ,
          `user`
          WHERE
          appointment.appointment_userid2 = #{id} AND appointment.appointment_userid1= `user`.user_id
          ORDER BY
          appointment.appointment_time DESC
    </select>

    <select id="selectSendApt" resultMap="appointmentResultMap">
        SELECT
          appointment.appointment_id,
          appointment.appointment_userid1,
          appointment.appointment_userid2,
          appointment.appointment_time,
          appointment.appointment_agree,
          appointment.appointment_reason,
          appointment.appointment_fromId,
          `user`.user_name,
          `user`.user_gender,
          `user`.user_avater,
          `user`.user_address,
          `user`.user_identity
          FROM
          appointment ,
          `user`
          WHERE
          appointment.appointment_userid1 = #{id} AND appointment.appointment_userid2= `user`.user_id
          ORDER BY
          appointment.appointment_time DESC
    </select>
    <select id="selectDynamicById" resultMap="DynamicResultMap">
        SELECT
        dynamic.dynamic_id,
        dynamic.dynamic_address,
        dynamic.dynamic_require,
        dynamic.dynamic_date,
        dynamic.dynamic_area,
        dynamic.dynamic_who,
        dynamic.dynamic_num,
        dynamic.dynamic_time,
        dynamic.dynamic_money,
        dynamic.dynamic_finish,
        dynamic.dynamic_img,
        dynamic.dynamic_style,
        dynamic.dynamic_userid,
        dynamic.dynamic_gender,
        `user`.user_identity,
        `user`.user_name,
        `user`.user_avater
        FROM
        dynamic ,
        `user`
        WHERE
        dynamic.dynamic_id = #{id} AND dynamic.dynamic_userid = `user`.user_id
    </select>

    <select id="selectDynamicByNum" resultMap="DynamicResultMap">
        SELECT
        dynamic.dynamic_id,
        dynamic.dynamic_address,
        dynamic.dynamic_require,
        dynamic.dynamic_date,
        dynamic.dynamic_area,
        dynamic.dynamic_who,
        dynamic.dynamic_num,
        dynamic.dynamic_time,
        dynamic.dynamic_money,
        dynamic.dynamic_finish,
        dynamic.dynamic_img,
        dynamic.dynamic_style,
        dynamic.dynamic_userid,
        dynamic.dynamic_gender,
        `user`.user_avater,
        `user`.user_identity,
        `user`.user_name
        FROM
        dynamic ,
        `user`
        WHERE
        dynamic.dynamic_userid = `user`.user_id
        ORDER BY
        dynamic.dynamic_num DESC

    </select>
</mapper>